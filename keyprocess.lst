C51 COMPILER V9.01   KEYPROCESS                                                            01/14/2019 21:22:33 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE KEYPROCESS
OBJECT MODULE PLACED IN keyprocess.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE src\keyprocess.c COMPACT BROWSE PRINT(.\keyprocess.lst) OBJECT(keyprocess.o
                    -bj)

line level    source

   1          #include "../h/port.h"
   2          #include "../h/serial.h"
   3          #include "../h/stopwatch.h"
   4          #include "../h/keyprocess.h"
   5          sbit g_key_state = P1^0;
   6          
   7          #define PUSHED 0
   8          #define POPED 1
   9          bit   volatile g_key_released_inter = 0,g_key_released;
  10          bit   volatile g_key_pressed_inter  = 0,g_key_pressed;
  11          uchar volatile g_key_pressing_1s_inter = 0,g_key_pressing_1s;
  12          
  13          void process_key(void)
  14          {
  15   1          static int delay = 0;
  16   1      //      send_buffer("PUSHED");
  17   1          if(delay > 1)
  18   1          {
  19   2              delay--;
  20   2              return;
  21   2          }
  22   1          if(PUSHED == g_key_state && 0 == g_key_pressed_inter && 0 == g_key_pressing_1s_inter && 0 == delay)
  23   1          {
  24   2              delay = 100;
  25   2              return;
  26   2          }
  27   1          else if(0 == g_key_pressed_inter && 0 == g_key_pressing_1s_inter && delay == 1)
  28   1          {
  29   2              delay = 0;
  30   2          }
  31   1      
  32   1          if(PUSHED == g_key_state)
  33   1          {
  34   2             if(0 == g_key_pressing_1s_inter)
  35   2             {
  36   3                 g_key_pressed_inter = 1;send_buffer("PUSHED");
  37   3                 g_key_pressing_1s_inter = 1;
  38   3                 g_1s_key_timer = e_timer_start;
  39   3             }
  40   2             else
  41   2             {
  42   3                 g_key_pressed_inter = 0;
  43   3                 if(g_1s_key_timer == e_timer_finished)
  44   3                 {
  45   4                     g_1s_key_timer = e_timer_start;
  46   4                     g_key_pressing_1s_inter++;
  47   4                 }
  48   3             }
  49   2             g_key_released_inter = 0;
  50   2          }
  51   1          else
  52   1          {
  53   2             if(g_key_pressing_1s_inter)
  54   2             {
C51 COMPILER V9.01   KEYPROCESS                                                            01/14/2019 21:22:33 PAGE 2   

  55   3                 g_key_released_inter = 1; send_buffer("key releasexxd");
  56   3                 g_key_pressed_inter  = 0;
  57   3                 g_key_pressing_1s_inter = 0;
  58   3             }
  59   2             else
  60   2             {
  61   3                 g_key_released_inter = 0;
  62   3             }  
  63   2          }
  64   1      }
  65          bit g_key_juggle_start =0;
  66          void INT0_Isr() interrupt 0
  67          {
  68   1      //      if(INT0)
  69   1              {
  70   2              }
  71   1      //      else
  72   1              {
  73   2              }
  74   1      //      process_key();
  75   1      }
  76          #ifdef KEY_INTERRUPT_
              void init_key(void)
              {
                  IT0 = 0;//enable INT0 raise and fall interrupt
              //      EX0 = 1;  //enable INT0 interrupt
                      EA = 1;
                  
              }
              #endif
  85          void get_key_state()
  86          {
  87   1              g_key_released = g_key_released_inter;
  88   1              g_key_pressed = g_key_pressed_inter;
  89   1              g_key_pressing_1s = g_key_pressing_1s_inter;
  90   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    163    ----
   CONSTANT SIZE    =     22    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =      4    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      5    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
